@for (preferredMeetingPlace of preferredMeetingPlacesDisplay; track preferredMeetingPlace.name; let i = $index) {
  <address class="meeting-place">
    <!-- Address number -->
    <strong class="number">{{ i + 1 }}</strong>
    <!-- Address name -->
    <strong class="address-name">{{ preferredMeetingPlace.name }}</strong>
    <!-- Address details -->
    <div class="address-detail">
      {{ preferredMeetingPlace.street }}<br>
      {{ preferredMeetingPlace.postalCode }} {{ preferredMeetingPlace.city | titlecase }}
    </div>
  </address>
  @if (preferredMeetingPlacesDisplay.length > 1) {
    <a type="button" id="remove-address-icon" (click)="deletePreferredMeetingPlace(i)">
      <img class="remove-icon" src="assets/icons/buttons/remove-grey.webp" alt="icône supprimer">
    </a>
  }
}

@if (isAddButtonClicked) {
  <div [formGroup]="preferredMeetingPlaceFormGroup" id="preferred-meeting-places">
    <strong class="number">{{ preferredMeetingPlacesDisplay.length + 1 }}</strong>
    <div class="row my-3 mt-5">
      <div class="col-8">
        <label for="name">Nom</label>
        <input type="text" formControlName="name" id="name" name="name" class="form-control" placeholder="Nom du lieu" required/>
        @if (preferredMeetingPlaceFormGroup.get('name')?.errors && preferredMeetingPlaceFormGroup.get('name')?.touched) {
          <div [hidden]="!preferredMeetingPlaceFormGroup.get('name')?.errors?.['required']" class="error-msg">Veuillez renseigner un nom de lieu</div>
          <div [hidden]="!preferredMeetingPlaceFormGroup.get('name')?.errors?.['alreadyExists']" class="error-msg">Ce nom de lieu existe déjà</div>
        }
      </div>
    </div>
    <div class="row my-3 mt-5">
      <div class="col-8">
        <label for="street">Rue</label>
        <mapbox-address-autofill>
          <input type="text" formControlName="street" autocomplete="address-line1" id="street" name="street" class="form-control" placeholder="Numéro et nom de rue"required/>
        </mapbox-address-autofill>
        @if (preferredMeetingPlaceFormGroup.get('street')?.errors && preferredMeetingPlaceFormGroup.get('street')?.touched) {
          <div [hidden]="!preferredMeetingPlaceFormGroup.get('street')?.errors?.['required']" class="error-msg">Veuillez renseigner une rue</div>
          <div [hidden]="!preferredMeetingPlaceFormGroup.get('street')?.errors?.['alreadyExists']" class="error-msg">Cette adresse a déjà été enregistrée</div>
        }
      </div>
    </div>
    <div class="row my-3 mt-5">
      <div class="col-4">
        <label for="postal-code">Code postal</label>
        <input type="text" formControlName="postalCode" autocomplete="postal-code" id="postal-code" name="postal-code" class="form-control" required/>
        @if (preferredMeetingPlaceFormGroup.get('postalCode')?.errors && preferredMeetingPlaceFormGroup.get('postalCode')?.touched) {
          <div class="error-msg">Veuillez renseigner un code postal</div>
        }
      </div>
      <div class="col-4">
        <label for="city">Ville</label>
        <input type="text" formControlName="city" autocomplete="address-level2" id="city" name="city" class="form-control" required/>
        @if(preferredMeetingPlaceFormGroup.get('city')?.errors && preferredMeetingPlaceFormGroup.get('city')?.touched) {
          <div class="error-msg">Veuillez renseigner un code postal</div>
        }
      </div>
    </div>
    @if (preferredMeetingPlacesDisplay.length > 0) {
      <a type="button" id="remove-form-icon" (click)="deletePreferredMeetingPlaceForm()">
        <img class="remove-icon" src="assets/icons/buttons/remove-grey.webp" alt="icône supprimer">
      </a>
    }
  </div>
}
@if (preferredMeetingPlacesDisplay.length < 5) {
  <a type="button" id="add-address-icon" (click)="addPreferredMeetingPlace()">
    <img class="add-icon" src="assets/icons/buttons/add-orange.webp" alt="icône ajout">
    <p class="add-text">ajouter un lieu</p>
  </a>
}
@if (preferredMeetingPlaceForm.invalid && preferredMeetingPlacesDisplay.length === 0) {
  <div class="error-msg">Veuillez renseigner au moins une adresse</div>
}

